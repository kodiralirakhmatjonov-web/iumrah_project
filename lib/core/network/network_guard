import 'dart:io';
import 'package:flutter/material.dart';
import 'package:connectivity_plus/connectivity_plus.dart';
import 'package:iumrah_project/splash/no_connection_page';
import '../navigation/premium_route.dart';

//import 'package:iumrah_project/splash/no_connection_page.dart';

class NetworkGuard {
  static Future<T> run<T>({
    required BuildContext context,
    required Future<T> Function() request,
  }) async {
    final connectivity = await Connectivity().checkConnectivity();

    if (connectivity == ConnectivityResult.none) {
      _open(context);
      throw Exception('No internet');
    }

    try {
      return await request();
    } on SocketException {
      _open(context);
      rethrow;
    }
  }

  static void _open(BuildContext context) {
    Navigator.of(context).push(
      PremiumRoute.push(const NoConnectionPage()),
    );
  }
}
